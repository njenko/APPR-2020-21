---
title: "Analiza borznih indeksov"
author: "Nejc Jenko"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

Opazovali bomo 10 borznih indeksov v letu 2020 in analizirali njihovo odvisnost.

![](slike/two-growth-stocks-to-buy-now.png){width=50%}

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Uvozili smo 10 tabel s podatki za posamezno borzo. Podatki so v obliki csv, prenešeni iz spletne strani Yahoo Finance. Tabelo z informacijami o borzah pa smo uvozili v obliki HTML iz Wikipedije.

1. **TABELE POSAMEZNIH  BORZ**
  - `Date` - Datum opravljenih meritev (meritve so opravljene od 1. 1. 2020 tedensko) - tip podatka: date,
  - `Name` - Kratica borze, za katero so prikazani podatki - tip podatka: character,
  - `Open` - Vrednost indeksa ob odprtju borze na prvi dan tedna - tip podatka: numeric,
  - `High` - Najvišja vrednost indeksa v opazovanem tednu - tip podatka: numeric,
  - `Low` - Najnižja vrednost indeksa v opazovanem tednu - tip podatka: numeric,
  - `Close` - Vrednost indeksa ob zaprtju borze na zadnji dan tedna - tip podatka: numeric,
  - `Volume` - Količina izmenjanih delnic v opazovanem obdobju v lokalni denarni enoti - tip podatka: numeric,
  - `Growth` - Rast indeksa v danem obdobju, izračunan iz vrednosti indeksa ob odprtju in zaprtju - tip podatka: numeric

Lahko vidimo,da te podatki še niso v obliki *tidy data*. V takšno obliko jih bomo dali, šele, ko te tabele združimo. Z operacijo *bind_rows* smo združili vseh 10 tabel v eno in jo nato spremenili v obliko *tidy data*, da smo dobili novo tabelo:

2. **SKUPNA TABELA Z VSEMI BORZAMI**
 - `Date` - Datum opravljenih meritev (meritve so opravljene od 1. 1. 2020 tedensko) - tip podatka: date,
 - `Name` - Kratica borze, za katero so prikazani podatki - tip podatka: character,
 - `Measurement_type`- Nam pove katera meritev je prikazana v zadnji vrstici tabele - tip podatka: character,
 - `Measurement` - Meritev - tip podatka: numeric.

3. **TABELA Z INFORMACIJAMI  O BORZAH**
  - `Borza` - Polno ime borze - tip podatka: character,
  - `Simbol` - Oznaka borze, ki jo kasneje uporabljam za povezavo med tabelama - tip podatka: character,
  - `Drzava` - Država, kjer je sedež borze - tip podatka: character,
  - `Kraj` - Kraj, kjer je sedež borze - tip podatka: character,
  - `Market_cap` - meritev: število naselij v občini (število),
  - `Monthly_volume` - meritev: leto ustanovitve občine (število),
  

```{r histogram, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
#ggplot(obcine, aes(x=naselja)) + geom_histogram() +
  #ggtitle("Pogostost števila naselij") + xlab("Število naselij") + ylab("Število občin")
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, results='hide'}
#source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Na spodnjem grafu lahko vidimo rast indeksov skozi prejšnje leto. Večino časa se gibljejo razmeroma podobno. Zelo hitro lahko opazimo največji padec v mesecu marcu, ki ga je povzročil prvi val koronavirusa. Vidimo lahko tudi, da se je  indeks zelo hitro pobral in celo močno narastel nad vrednost pred krizo. Ponoven padec lahko vidimo v septembru in novembru, ko je prišel drugi val virusa. Prav tako so se indeksi zelo hitro povzpeli nazaj na vrednosti po prvem valu.

```{r}
ggplot(data=skupnaTabela %>% filter(Measurement_Type == "Growth", Name %in% c("NYSE", "NASDAQ", "N225", "FTSE", "SSE", "AEX", "TSX",  "DAX", "ASX", "IBOVESPA")), aes(x=Date, y=Measurement, color=Name)) + geom_line()
```
```{r}
ggplot(data=skupnaTabela %>% filter(Measurement_Type %in% c("Open", "High", "Low"), Name == "NYSE"), aes(x=Date, y=Measurement, fill = Measurement_Type)) + geom_col(position = "dodge") + 
   coord_flip() +
   theme(legend.position = "top")

```
 

```{r zemljevid, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
#tm_shape(merge(zemljevid, povprecja, by.x="OB_UIME", by.y="obcina")) +
#  tm_polygons("povprecje", title="Povprečje") +
#  tm_layout(title="Povprečno število otrok v družini")
```

***

# Napredna analiza podatkov

```{r analiza}
#source("analiza/analiza.r", encoding="UTF-8")
```


```{r graf, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
#ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
#                                     skupina=factor(skupine)), by="obcina")
#, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
#  ggtitle("Število naselij glede na površino občine") +
 # xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
#  guides(color=guide_legend(title="Skupina"),
#         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny}
#shinyAppDir("shiny", options=list(width="100%", height=600))
```
